# The strength of selection for costly toxin production increases with growth rate

![Bacterial ecology](https://github.com/bisesi/Toxins-Growth-Rate/blob/main/figures/final-figs/imgs/figure-1-final.png)

### Authors:

Ave T. Bisesi, Jeremy M. Chac√≥n, Michael J. Smanski, and William R. Harcombe

## Repository Overview

This code repository contains the necessary data and scripts to reproduce the figures and analyses presented in the manuscript, "The strength of selection for costly toxin production increases with growth rate." The paper preprint is available at bioxrxiv.

To reproduce the analyses, clone or download the project and follow the instructions provided below.

## Getting started

1. Clone or download the repository to your local machine.
2. If you are using R Studio, open the R project file, ```Toxins-Growth-Rate.Rproj```. This will set up your working directories correctly, so there is no need to change them manually. 

## Figure generation

Figures can be recreated using the individual scripts found in the folder ```figures/final-figs/scripts```. Note that the toxin simulation data in the `toxin-simulations` folder will need to be unzipped prior to attempts to generate figures with these files. 

## Simulation and bioinformatics data

Data for all simulations presented in the paper are contained in two zipped files in the folder `toxin-simulations` - one file contains data for liquid simulations, and the other all spatial simulation data. Data can also be regenerated by users using the scripts in the `toxin-simulations/scripts` folder. Most parameters and functions are explained in the paper, but additional documentation on successful implementation of these simulations is available at https://bisesi.github.io/Toxins-Growth-Rate/. 

Data and scripts for all bioinformatics analyses are available in the folder `bioinformatics-data`. For each dataset, there are shell and R scripts (in the `dataset/scripts` folder) available to generate the final datasets used in the paper, which are also available as csv files in their respective folders. In each case, the steps to generating our growth rate and BGC datasets would look something like this:

- Run the `import_annotations.sh` script, which takes as input a txt file with a of taxa (taxon names or accession numbers, depending on the dataset) to download .gbff and .fna files using the ncbi_datasets tool. This script places all .gbff and .fna files into a folder named `annotations` after cleaning the names of the files to match the taxon name or accession number used. 
- Next, run the `run_antismash.sh` script on the files in the `annotations` folder. This script will use .gbff files as the antismash input and move all the final summary antismash .html files into the `annotations` folder and rename them according to taxon name or accession number. Expect this process to take a very long time to complete, at least for the *Streptomyces* dataset (~1 week). If possible, it's best to run these scripts using a supercomputing cluster.
- Run the `generate_gRodon_rates.R` script on the .fna files in the `annotations` folder. This script will create a dataframe with the predicted doubling time, the upper confidence interval, and the lower confidence interval, all predicted by gRodon, along with the taxon name or accession number. This dataframe is saved in a .csv file called `grodon_growthrate_dataset.csv`.
- Run the `generate_antismash_dataset.R` on the .html files in the `annotations` folder. This script will import each .html file as a list, pull the concatenated list of predicted BGCs, and create a dataframe with the BGC information and associated taxon name or accession number. This dataframe is saved in a .csv file called `antismash_data.csv`.
- Run the `generate_final_bioinformatics_datasets.R` script in the `data-generation` folder. This will create a complete .csv of growth rates and BGCs for all three bioinformatics datasets used. Note that for the Vieira-Silva dataset, this is generated using the file `bioinformatics-data/rocha/supp-table-1.csv`, which contains the experimental doubling time data provided in the original publication. 

After generating these datasets, it is advisable to compress or delete the associated `annotations` folder with .gbff, .fna and .hmtl files due to its large size.

## Required Python Packages

Before running the scripts, ensure you have the following Python libraries installed. Additional information on these dependencies is available at https://bisesi.github.io/Toxins-Growth-Rate/.

- ```cobra```: Python toolbox for flux balance analysis.
- ```cometspy```: Python toolbox for dynamic flux balance analysis.
- ```random```: Pseudo-random number generator.
- ```pandas```: Data anlysis and manipulation tool.

## Required R Packages

Before running the scripts, ensure you have the following R packages installed:

- ```tidyverse```: A collection of R packages designed for data science. 
- ```cowplot```: Functions for creating publication-ready plots.
- ```tidytext```: Functions for creating publication-ready plots.
- ```ggtext```: Functions for creating publication-ready plots.
- ```rvest```: Functions to download and manipulate HTML and XML files.
- ```gRodon```: Functions to estimate maximal growth rates of prokaryotes and microbial eukaryotes. 
- ```Biostrings```: Functions for fast manipulations of large biological sequences or sets of sequences.
- ```boot```: Functions for bootstrap resampling. 
- ```mosaic```: Functions to facilitate statistical analyses.
